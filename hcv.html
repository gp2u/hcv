<!DOCTYPE html>
<html>
<head>
<title>HCV Decision Support</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.blockUI/2.66.0-2013.10.09/jquery.blockUI.js"></script>
<style>

p,td,input,div,select { font-family: sans-serif; font-size:1em;}
td { padding: 2px 0;}
label { float:right; padding-right:3px;}

.narrow { width:40px; font-size:0.8em;}
.notes { font-size:0.90em }
.error { color:red;}

@media print {
    #print { display:none;}
    #dataInput { display:none;}
}

</style>
</head>

<body>

<script>
var version = '1.2';

var drugs = {
    sof: {
        generic: 'Sofosbuvir',
        dose: ['400mg'],
        brand: [
        'Solvadi',
        'Hopetavir (Incepta)',
        'Sofovir (Hetero)',
        'Hepcinat (Natco)',
        'Soforal (Beacon)',
        'Hepcvir (Cipla)',
        'Sofovir-C (Beximco)',
        'Hepcee (Julphar)',
        'MyHep (Mylan)'
        ],
        route: 'PO',
        freq: 'daily'
   },
    sof_led: {
        generic: 'Sofosbuvir/Ledipasvir',
        dose: ['400mg/90mg'],
        brand: [
        'Harvoni',
        'Twinvir (Incepta)',
        'Hepcvir-L (Cipla)',
        'Ledifos (Hetero)',
        'Hepcinat LP (Natco)',
        'Lesovir-C (Beximco)',
        'Combicee (Julphar)',
        'MyHep LVIR (Mylan)'
        ],
        route: 'PO',
        freq: 'daily'
    },
    dac: {
        generic: 'Daclatasvir',
        dose: ['60mg','30mg'],
        brand: [
        'Daklinza',
        'Virodacla (Incepta)',
        'Daclahep (Hetero)',
        'Daclavir (Beacon)',
        'Daclacee (Julphar)'
        ],
        route: 'PO',
        freq: 'daily'
    },
    riba: {
        generic: 'Ribavirin',
        dose: ['200mg','400mg','600mg'],
        brand: [
        'Ibavyr',
        'Celbarin (Incepta)',
        'Ribacee (Julphar)'
        ],
        route: 'PO',
        freq: 'daily divided into 2 doses'
    },
    viekira1: {
        generic: 'Paritaprevir/Ritonavir',
        dose: [ '150mg/100mg' ],
        brand: [ 'Viekira Pak' ],
        route: 'PO',
        freq: 'daily'
    },
    viekira2: {
        generic: 'Ombitasvir',
        dose: [ '25mg' ],
        brand: [ 'Viekira Pak' ],
        route: 'PO',
        freq: 'daily'
    },
    viekira3: {
        generic: 'Dasabuvir',
        dose: [ '250mg' ],
        brand: [ 'Viekira Pak' ],
        route: 'PO',
        freq: 'twice daily'
    },
    peg: {
        generic: 'Peginterferon-&alpha;',
        dose: [ '180&mu;g'],
        brand: [ 'Pegasys' ],
        route: 'SC',
        freq: 'weekly'
    },
    sim: {
        generic: 'Simeprevir',
        dose: [ '150mg' ],
        brand: [ 'Olysio' ],
        route: 'PO',
        freq: 'daily'
    }
};

function supportDecision () {

    $("#demographics").html('');
    $("#rx").html('');
    var h = new Object();
    h.genotype  = $("#genotype option:selected").text();
    h.fibrosis  = $("#fibrosis option:selected").text();
    h.harvoniCI = $("input[name=harvoniCI]:checked").val();
    h.guidelines= $("input[name=guidelines]:checked").val();
    h.past      = $("#past option:selected").val();
    h.pastTxt    = $("#past option:selected").text();
    h.riba      = $("#riba:checked").length == 1 ? true : false;
    h.platelets = parseInt($("#platelets").val());
    h.weight    = $("input[name=weight]:checked").val();
    h.eGFR      = $("#eGFR").val();
    h.eGFR      = h.eGFR.replace('>','');
    h.eGFR      = parseInt(h.eGFR);
    h.locale    = h.guidelines == 'AASLD' ? 'en-US' : h.guidelines == 'EASL' ? 'en-GB' : 'en-AU';

    var error = '';
    if (h.genotype  == '' ) error += 'Please select Genotype<br>';
    if (h.fibrosis  == '' ) error += 'Please select Fibrosis<br>';
    if (h.pastTxt   == '' ) error += 'Please select Past Treament<br>';
    if (h.harvoniCI === undefined ) error += 'Please select Harvoni CI<br>';
    if (h.riba) {
        if (isNaN(h.platelets)) error += 'Please input Platelets<br>';
        if (typeof h.weight === "undefined") error += 'Please select Weight<br>';
        if (isNaN(h.eGFR)) error += 'Please input eGFR<br>';   
    }
    if (error != '') {
        blockMessage(error,1000);
        setTimeout(function(){$("#demographics").html('<span class="error">'+error+'</span>')},1000);      
        return;
    }

    h.fail =  (h.past == 'naive' || h.past == 'PEG' ) ? false : true;
    h.harvoniCI = (h.harvoniCI == 'yes') ? true : false;

    // visual feedback to user
    blockMessage('Calculating...',500);
    $("#calculate").val('Recalculate');
    setTimeout(function(){doCalculation(h)},500);
}

function doCalculation (h) {

    renderDemographics(h);
    renderRx(h);
}

function renderDemographics(h) {

    var demographics = 'Guidelines:     ' + h.guidelines + '\n' +
                       'Genotype:       ' + h.genotype   + '\n' +
                       'Fibrosis:       ' + h.fibrosis   + '\n' + 
                       'Past Treatment: ' + h.pastTxt    + '\n' +
                       'Past Failure:   ' + h.fail       + '\n' +
                       'Harvoni CI:     ' + h.harvoniCI  + '\n' +
                       'Ribavirin:      ' + h.riba       + '\n';
    if ( h.riba ) {
        demographics += 
                       'Platelets:      ' + h.platelets      + '\n' +
                       'Weight:         ' + h.weight + ' kg' + '\n' +
                       'eGFR:           ' + $("#eGFR").val() + '\n';
    }
    var d = new Date();
    demographics = '<p><b>HCV Decision Support v' + version + ' ' + d.toLocaleString(h.locale) + '</b></p><pre>' + demographics + '</pre>';
    $("#demographics").html(demographics);
} 

function renderRx(h) {

    h.rx = [];
    getRxOptions(h); //alert(JSON.stringify(h));
    var html = '';
    // display by descending SVR
    h.rx.sort(function(a, b){return b.svr-a.svr});

    for ( var m in h.rx ) {
        var svrOdds = Math.round(100/(100-h.rx[m].svr)) - 1;
        var days = h.rx[m].duration == 24 ? '84 days + 1 repeat' : '84 days + no repeats';
        var medication = '';
        for ( var d in h.rx[m].medication ) {
            var drug = h.rx[m].medication[d];
            if ( parseInt(d) > 0 ) medication += ' + ';
            medication += drug.generic + ' (' + drug.brand[0] + ') ' + drug.dose[0] + ' ' + drug.route +', ' + drug.freq;
            var drugSort = drug.brand.slice();
            drugSort.sort();
            h.rx[m].notes.push(drug.generic + ' brand names: ' + drugSort.join(', '));
        }
        html += '<hr>' +
                '<b>Medications:</b> '   + medication + '<br>' +
                '<b>Duration:</b> '     + h.rx[m].duration + ' weeks (' + days + ')<br>' +
                '<b>Expected SVR:</b> ' + h.rx[m].svr + '% (Odds of SVR are '  + svrOdds + ':1)<br>';

        h.rx[m].notes.unshift('Check for interactions using <a href="http://www.hep-druginteractions.org/Interactions.aspx" target="_new">http://www.hep-druginteractions.org/Interactions.aspx</a>');
        html += '<br><div class="notes"><b>Notes:</b><ol>';
        for (var i in h.rx[m].notes) {
            html += '<li>' + h.rx[m].notes[i] + '</li>';
        }
        html += '</ol></div>';
    }
    html += '<div id="print"><hr><input type="button" value="Print" onclick="window.print()"></div>'
    $("#rx").html(html);
}

function getRxOptions(h) {

    if (h.guidelines == 'AUS') {
        if ( h.genotype.match(/1/) ) rxGT1AUS(h);
        if ( h.genotype.match(/2/) ) rxGT2AUS(h);   
        if ( h.genotype.match(/3/) ) rxGT3AUS(h);
        if ( h.genotype.match(/4/) ) rxGT4AUS(h);
        if ( h.genotype.match(/5/) ) rxGT5AUS(h);
        if ( h.genotype.match(/6/) ) rxGT6AUS(h);       
    }
    else if (h.guidelines == 'EASL') {
        blockMessage('EASL not yet implemented',2000);
        if ( h.genotype.match(/1/) ) rxGT1EASL(h);
        if ( h.genotype.match(/2/) ) rxGT2EASL(h);   
        if ( h.genotype.match(/3/) ) rxGT3EASL(h);
        if ( h.genotype.match(/4/) ) rxGT4EASL(h);
        if ( h.genotype.match(/5/) ) rxGT5EASL(h);
        if ( h.genotype.match(/6/) ) rxGT6EASL(h); 
    }
    else if (h.guidelines == 'AASLD') {
        blockMessage('AASLD not yet implemented',2000);
        if ( h.genotype.match(/1/) ) rxGT1AASLD(h);
        if ( h.genotype.match(/2/) ) rxGT2AASLD(h);   
        if ( h.genotype.match(/3/) ) rxGT3AASLD(h);
        if ( h.genotype.match(/4/) ) rxGT4AASLD(h);
        if ( h.genotype.match(/5/) ) rxGT5AASLD(h);
        if ( h.genotype.match(/6/) ) rxGT6AASLD(h); 
    }
    else if (h.guidelines == 'FIXHEPC') {
        if ( h.genotype.match(/1/) ) rxGT1(h);
        if ( h.genotype.match(/2/) ) rxGT2(h);   
        if ( h.genotype.match(/3/) ) rxGT3(h);
        if ( h.genotype.match(/4/) ) rxGT4(h);
        if ( h.genotype.match(/5/) ) rxGT5(h);
        if ( h.genotype.match(/6/) ) rxGT6(h);       
    }
    else {
        alert('OMG, the flux capacitor has imploded!');
    }

}

/* AUS Treatment Protocols */

function rxGT1AUS (h) {

    // sof dac
    h.rx.unshift({ 
        medication:[ drugs.sof, drugs.dac ], 
        duration: 12,
        svr: 96, 
        notes: ['Daclatasvir levels are elevated by CYP3A4 inhibitors'] 
    });
    if ( h.past == 'PROTEASE' ) {
        h.rx[0].duration = 24;
        h.rx[0].svr = 90;
        h.rx[0].notes.push('24 weeks recommended for patients who have failed a protease inhibitor');
    }
    if ( h.fibrosis.match(/F4/) ) {
        h.rx[0].svr = 90;
        if ( h.past != 'PROTEASE' ) {
            h.rx[0].notes.push('<span class="error">Consider adding Ribavirin or extending treatment to 24 weeks</span>');
        }
    }
    // viekira pak
    h.rx.unshift({
        medication: [ drugs.viekira1, drugs.viekira2, drugs.viekira3 ],
        duration: 12,
        svr: 97,
        notes: []
    })
    if ( ! h.genotype.match(/1b/)) {
        addRiba(h,h.rx[0]);
        h.rx[0].svr = 95;

    }
    // harvoni
    if (hasHarvoniCI(h)) return;
    h.rx.unshift({
        medication: [ drugs.sof_led ],
        duration: 12,
        svr: 96,
        notes: []
    })
    if ( h.genotype.match(/1b/)) h.rx[0].svr = 98;
    if ( h.fibrosis.match(/F4/) && h.fail ) {
        h.rx[0].duration = 24;
        h.rx[0].svr      = 94;
        h.rx[0].notes.push('12 weeks + Ribavirin may be considered');
    }
    if ( ! h.fail && ! h.fibrosis.match(/F4/) ) {
        h.rx[0].notes.push('8 weeks may be considered if HCV RNA < 6 x 10^6 IU/ml');
    }
}

function rxGT2AUS (h) {

    // sof riba
    h.rx.unshift({
        medication: [ drugs.sof ],
        duration: 12,
        svr: 96,
        notes: []
    });
    addRiba(h,h.rx[0]);
    if ( h.fibrosis.match(/F4/) ) {
        h.rx[0].svr      = 94;
        h.rx[0].notes.push('<span class="error">SVR rates may be increased by extending duration to 16-24 weeks</span>');
    }
}

function rxGT3AUS (h) {

    // sof dac
    h.rx.unshift({ 
        medication:[ drugs.sof, drugs.dac ], 
        duration: 12,
        svr: 96, 
        notes: ['Daclatasvir levels are elevated by CYP3A4 inhibitors'] 
    });
    if ( h.fibrosis.match(/F4/) ) {
        h.rx[0].duration = 24;
        h.rx[0].svr      = 94;
        h.rx.unshift({ 
            medication:[ drugs.sof, drugs.dac ], 
            duration: 16,
            svr: 94, 
            notes: ['Daclatasvir levels are elevated by CYP3A4 inhibitors'] 
        });
        addRiba(h,h.rx[0]);
    }
    // sof riba
    h.rx.unshift({
        medication: [ drugs.sof ],
        duration: 24,
        svr: 93,
        notes: []
    });
    addRiba(h,h.rx[0]);
    if ( h.fibrosis.match(/F4/) ) {
        h.rx[0].svr      = 67;
    }
    // sof peg riba
    h.rx.unshift({
        medication: [ drugs.sof, drugs.peg ],
        duration: 12,
        svr: 85,
        notes: []
    });
    addRiba(h,h.rx[0]);    
}

function rxGT4AUS (h) {

    // sof peg riba
    h.rx.unshift({
        medication: [ drugs.sof, drugs.peg ],
        duration: 12,
        svr: 90,
        notes: []
    });
    addRiba(h,h.rx[0]); 
    // sim peg riba
    h.rx.unshift({
        medication: [ drugs.sim, drugs.peg ],
        duration: 48,
        svr: 85,
        notes: [ 'Duration 24-48 weeks']
    });
    addRiba(h,h.rx[0]);
}

function rxGT5AUS (h) {

    // sof peg riba
    h.rx.unshift({
        medication: [ drugs.sof, drugs.peg ],
        duration: 12,
        svr: 90,
        notes: []
    });
    addRiba(h,h.rx[0]); 
}

function rxGT6AUS (h) {

    // sof peg riba
    h.rx.unshift({
        medication: [ drugs.sof, drugs.peg ],
        duration: 12,
        svr: 90,
        notes: []
    });
    addRiba(h,h.rx[0]);    
}

/* EASL stubs */
function rxGT1EASL (h) {}
function rxGT2EASL (h) {}
function rxGT3EASL (h) {}
function rxGT4EASL (h) {}
function rxGT5EASL (h) {}
function rxGT6EASL (h) {}

/* AASLD stubs */
function rxGT1AASLD (h) {}
function rxGT2AASLD (h) {}
function rxGT3AASLD (h) {}
function rxGT4AASLD (h) {}
function rxGT5AASLD (h) {}
function rxGT6AASLD (h) {}

/* SVR and Rx References 

http://www.hepatitisc.uw.edu/go/treatment-infection/treatment-genotype-1/core-concept/all
https://www.gilead.com/~/media/Files/pdfs/medicines/liver-disease/harvoni/harvoni_pi.pdf
http://www.easl.eu/medias/cpg/HEPC-2015/Summary.pdf

*/

function rxGT1 (h) {
   // sof dac
    h.rx.unshift({ 
        medication:[ drugs.sof, drugs.dac ], 
        duration: 12,
        svr: 96, 
        notes: ['Daclatasvir levels are elevated by CYP3A4 inhibitors'] 
    });
    if ( h.fibrosis.match(/F4/) || h.past == 'PROTEASE' ) {
        h.rx[0].duration = 24;
        h.rx[0].svr = 90;
        if ( h.past == 'PROTEASE' ) h.rx[0].notes.push('24 weeks recommended for patients who have failed a protease inhibitor');
    }
    // harvoni
    if (hasHarvoniCI(h)) return;
    h.rx.unshift({
        medication: [ drugs.sof_led ],
        duration: 12,
        svr: 96,
        notes: []
    })
    if ( h.genotype.match(/1b/)) h.rx[0].svr = 98;
    if ( h.fibrosis.match(/F4/) ) {
        h.rx[0].duration = 24;
        h.rx[0].svr      = 94;
    }
}

/* http://www.hepatitisc.uw.edu/go/treatment-infection/treatment-genotype-2/core-concept/all */

function rxGT2 (h) {
   // sof dac
    h.rx.unshift({ 
        medication:[ drugs.sof, drugs.dac ], 
        duration: 12,
        svr: 96, 
        notes: ['Daclatasvir levels are elevated by CYP3A4 inhibitors'] 
    });
    if ( h.fibrosis.match(/F4/) || h.past == 'PROTEASE' ) {
        h.rx[0].duration = 24;
        h.rx[0].svr = 90;
        if ( h.past == 'PROTEASE' ) h.rx[0].notes.push('24 weeks recommended for patients who have failed a protease inhibitor');
    }
}

/* http://www.hepatitisc.uw.edu/go/treatment-infection/treatment-genotype-3/core-concept/all */

function rxGT3 (h) {
   // sof dac
    h.rx.unshift({ 
        medication:[ drugs.sof, drugs.dac ], 
        duration: 12,
        svr: 96, 
        notes: ['Daclatasvir levels are elevated by CYP3A4 inhibitors'] 
    });
    if ( h.fibrosis.match(/F4/) || h.past == 'PROTEASE' ) {
        h.rx[0].duration = 24;
        h.rx[0].svr = 90;
        if ( h.past == 'PROTEASE' ) h.rx[0].notes.push('24 weeks recommended for patients who have failed a protease inhibitor');
    }
}

/* http://www.hepatitisc.uw.edu/go/treatment-infection/treatment-genotype-4/core-concept/all */

function rxGT4 (h) {
   // sof dac
    h.rx.unshift({ 
        medication:[ drugs.sof, drugs.dac ], 
        duration: 12,
        svr: 93, 
        notes: ['Daclatasvir levels are elevated by CYP3A4 inhibitors'] 
    });
    if ( h.fibrosis.match(/F4/) || h.past == 'PROTEASE' ) {
        h.rx[0].duration = 24;
        h.rx[0].svr = 90;
        if ( h.past == 'PROTEASE' ) h.rx[0].notes.push('24 weeks recommended for patients who have failed a protease inhibitor');
    }
    // harvoni
    if (hasHarvoniCI(h)) return;
    h.rx.unshift({
        medication: [ drugs.sof_led ],
        duration: 12,
        svr: 93,
        notes: []
    })
}

/* http://www.hepatitisc.uw.edu/go/treatment-infection/treatment-genotype-5-or-6/core-concept/all */

function rxGT5 (h) {
    // sof dac
    h.rx.unshift({ 
        medication:[ drugs.sof, drugs.dac ], 
        duration: 12,
        svr: 93, 
        notes: ['Daclatasvir levels are elevated by CYP3A4 inhibitors'] 
    });
    if ( h.fibrosis.match(/F4/) || h.past == 'PROTEASE' ) {
        h.rx[0].duration = 24;
        h.rx[0].svr = 90;
        if ( h.past == 'PROTEASE' ) h.rx[0].notes.push('24 weeks recommended for patients who have failed a protease inhibitor');
    }
    // harvoni
    if (hasHarvoniCI(h)) return;
    h.rx.unshift({
        medication: [ drugs.sof_led ],
        duration: 12,
        svr: 93,
        notes: []
    })
}

/* http://www.hepatitisc.uw.edu/go/treatment-infection/treatment-genotype-5-or-6/core-concept/all */

function rxGT6 (h) {
   // sof dac
    h.rx.unshift({ 
        medication:[ drugs.sof, drugs.dac ], 
        duration: 12,
        svr: 96, 
        notes: ['Daclatasvir levels are elevated by CYP3A4 inhibitors'] 
    });
    if ( h.fibrosis.match(/F4/) || h.past == 'PROTEASE' ) {
        h.rx[0].duration = 24;
        h.rx[0].svr = 90;
        if ( h.past == 'PROTEASE' ) h.rx[0].notes.push('24 weeks recommended for patients who have failed a protease inhibitor');
    }
    // harvoni
    if (hasHarvoniCI(h)) return;
    h.rx.unshift({
        medication: [ drugs.sof_led ],
        duration: 12,
        svr: 96,
        notes: []
    })
}

function hasHarvoniCI (h) {
    if (h.harvoniCI) {
        var msg = '<span class="error">Sofosbuvir/Ledipasvir not being recommended due to Harvoni CI(s)</span>';
        blockMessage(msg);
        h.rx[0].notes.push(msg);
        return true;
    }
    return false;
}

function addRiba(h,rx) {
    if (! h.riba) {
        var msg = '<span class="error">Sorry, we can\'t accurately add Ribavirin without Ribavirin details. Please add them and recalculate</span>';
        blockMessage(msg);
        rx.notes.push(msg);
    }
    var ribaDose = h.riba ? calcRibaDose(h,rx) : 1000;
    rx.medication.push(drugs.riba);;
    rx.medication[rx.medication.length-1].dose = [ribaDose + 'mg'];
    rx.notes.push('Ribavirin uses requires frequent monitoring for pancytopaenia');
    if ( h.platelets < 50 ) rx.notes.push('<span class="error">Low platelets are a relative contraindication to Ribavirin</span>');
    rx.notes.push('Ribavirin (200mg Capsules): ' + calcRibaCaps(ribaDose));
    rx.notes.push('Ribavirin (Ibavyr 400mg &amp; 600mg Tablets): ' + calcRibaTabs(ribaDose));
}

function calcRibaDose (h,rx) {

    if ( ! h.riba ) return 0;
    var dose = 0;
    if ( h.weight == '>105' ) {
        dose = 1400;
    }
    else if ( h.weight == '81-105' ) {
        dose = 1200;
    }
    else if ( h.weight == '66-80' ) {
        dose = 1000;  
    }
    else if ( h.weight == '<66' ) {
        dose = 800;
    }
    else {
        alert('Error for weight: ' + h.weight );
    }
    if ( h.eGFR < 60 ) {
        rx.notes.push('<span class="error">Specialist advice highly recommended about Ribavirin dose</span>');
        dose =  h.eGFR > 30 ? dose/2 : dose/3;
    }
  
    return 100 * Math.round(dose/100);
}

// standard Riba formulation is 200 mg capsules
function calcRibaCaps (dose) {

    if ( dose >=1400 ) {
        return '3 in the morning 4 at night';
    }
    if ( dose >=1200 ) {
        return '3 in the morning 3 at night';
    }
    if ( dose >=1000 ) {
        return '2 in the morning 3 at night';
    }
    if ( dose >=800 ) {
        return '2 in the morning 2 at night';
    }
    if ( dose >=600 ) {
        return '1 in the morning 2 at night';
    }
    if ( dose >=400 ) {
        return '1 in the morning 1 at night';
    }
    if ( dose >=300 ) {
        return 'Alternating doses, 1 daily alternating with 2 daily every other day';
    }
    if ( dose >=200 ) {
        return '1 daily';
    }
    return '<span class="error">No Riba dose!</span>';
}

// Ibavyr tablets come in 400mg and 600mg scored
function calcRibaTabs (dose) {

    if ( dose >=1400 ) {
        return '2 x 400mg in the morning 600mg at night';
    }
    if ( dose >=1200 ) {
        return '600 mg morning and night';
    }
    if ( dose >=1000 ) {
        return '600mg in the morning 400mg at night';
    }
    if ( dose >=800 ) {
        return '400mg morning and night';
    }
    if ( dose >=600 ) {
        return '&frac12; 600mg morning and night';
    }
    if ( dose >=400 ) {
        return '&frac12; 400mg morning and night';
    }
    if ( dose >=300 ) {
        return '&frac12; 600mg daily';
    }
    if ( dose >=200 ) {
        return '&frac12; 400mg daily';
    }
    return '<span class="error">No Riba dose!</span>';
}

function setFibrosisFromKPa () {

    var kpa = parseFloat($("#kpa").val());

    if (isNaN(kpa)) {
        return;
    }

    if ( kpa >= 14.5 ) {
        $("#fibrosis").val('F4');
    }
    else if ( kpa >= 12.5 ) {
        $("#fibrosis").val('F3-F4');
    }
    else if ( kpa >= 9.5 ) {
        $("#fibrosis").val('F3');
    }
    else if ( kpa >= 8.5 ) {
        $("#fibrosis").val('F2');
    }
    else if ( kpa >= 7 ) {
        $("#fibrosis").val('F1-F2');
    }
    else {
        $("#fibrosis").val('F0-F1'); 
    }
 
}

function setFibrosisHepascore () {

    var hepascore = parseFloat($("#hepascore").val());

    if (isNaN(hepascore)) {
        return;
    }

    if ( hepascore >= 0.7 ) {
        $("#fibrosis").val('F4');
    }
    else if ( hepascore >= 0.5 ) {
        $("#fibrosis").val('F3-F4');
    }
    else if ( hepascore >= 0.3 ) {
        $("#fibrosis").val('F2');
    }
    else if ( hepascore >= 0.15 ) {
        $("#fibrosis").val('F1');
    }
    else {
        $("#fibrosis").val('F0-F1');
    }
}

function toggleRiba () {
    $("#riba:checked").length == 1 ? $("#ribavirin").slideDown() : $("#ribavirin").hide(400);
}

function blockMessage(message,timeout) {

        if (timeout === undefined) timeout = 3000;
        $.blockUI({ 
        message: message, 
        css: {
            border: 'none',
            top: '100px',
            padding: '10px 20px',
            backgroundColor: 'rgba(255, 255, 255, 1)',
            '-webkit-border-radius': '10px',
            '-moz-border-radius': '10px',
            'border-radius': '10px',
            color: '#000'
        },
        timeout: timeout,
    });
}
</script>

<div id="dataInput">
<div style="float:left;padding:4px 40px 0 0"><b>HCV Decision Support Tool</b></div>
<div style="float:left;" id="google_translate_element"></div>
<div style="clear:both"></div>
<hr>
<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en', layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, 'google_translate_element');
}
</script>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <table>
    <tr>
      <td>
        <label>Genotype</label>
      </td>
      <td>
        <select id="genotype">
          <option></option>
          <option>1</option>
          <option>1a</option>
          <option>1b</option>
          <option>2</option>
          <option>2a</option>
          <option>2b</option>
          <option>3</option>
          <option>3a</option>
          <option>3b</option>
          <option>4</option>
          <option>5</option>
          <option>6</option>
          <option>Unknown</option>
        </select>
      </td>
    </tr>
    <tr>
      <td>
        <label>Fibrosis</label>
      </td>
      <td>
        <select id="fibrosis">
          <option></option>
          <option>F0</option>
          <option>F0-F1</option>
          <option>F1</option>
          <option>F1-F2</option>
          <option>F2</option>
          <option>F2-F3</option>
          <option>F3</option>
          <option>F3-F4</option>
          <option>F4</option>
        </select>
        kPa
        <input type="text" class="narrow" id="kpa" onblur="setFibrosisFromKPa()"> Hepascore
        <input type="text" class="narrow" id="hepascore" onblur="setFibrosisHepascore()">
      </td>
    </tr>
    <tr>
      <td>
        <label>Past Treatment</label>
      </td>
      <td>
        <select id="past">
          <option></option>
          <option value="naive">Naive</option>
          <option value="PEG">Failed Interferon</option>
          <option value="PEGRIBA">Failed Interferon + Riba</option>
          <option value="PROTEASE">Failed Protease + Interferon + Riba</option>
          <option value="12NS5B">Failed Sofosbuvir 12 weeks</option>
          <option value="24NS5B">Failed Sofosbuvir 24 weeks</option>

        </select>
      </td>
    </tr>
    <tr>
      <td>
        <label>Harvoni CI<label>
      </td>
      <td>
        <input type="radio" name="harvoniCI" value="no"> No
        <input type="radio" name="harvoniCI" value="yes"> Yes (Amiodarone, Anticonvulsants, Antacids/PPIs/H2 blockers, St John's Wort)</td>
    </tr>
    <tr>
      <td>
        <label>Guidelines<label>
      </td>
      <td>
        <input type="radio" name="guidelines" value="AUS" checked="checked"> AUS
        <input type="radio" name="guidelines" value="EASL"> EASL
        <input type="radio" name="guidelines" value="AASLD"> AASLD
        <input type="radio" name="guidelines" value="FIXHEPC"> PEG/Riba Free
      </td>
    </tr>
    <tr>
      <td>
        <label>Ribavirin<label>
      </td>
      <td>
        <input type="checkbox" id="riba" onChange="toggleRiba()"> (Check this box to include ribavirin options)</td>
    </tr>
    <tr>
      <td> </td>
      <td>
        <fieldset id="ribavirin" style="display:none">
          <legend>Ribavirin Only</legend>
          <table>
            <tr>
              <td>
                <label>Platelets<label>
              </td>
              <td>
                <input type="text" class="narrow" id="platelets"> * If <50 Ribavirin presents significant risks
              </td>
            </tr>
            <tr>
              <td>
                <label>Weight<label>
              </td>
              <td>
                <input type="radio" name="weight" value="&lt;66"> &lt; 66kg
                <input type="radio" name="weight" value="66-80"> 66-80kg
                <input type="radio" name="weight" value="81-105"> 81-105kg
                <input type="radio" name="weight" value="&gt;105"> &gt; 105kg
              </td>
            </tr>
            <tr>
              <td>
                <label>eGFR<label>
              </td>
              <td>
                <input type="text" class="narrow" id="eGFR"> * Dose adjustment with CRF will be calculated
              </td>
            </tr>
          </table>
        </fieldset>
      </td>
    </tr>
    <tr>
      <td> </td>
      <td>
        <input type="button" value="Calculate" id="calculate" onclick="supportDecision()">
      </td>
    </tr>
  </table>
  <hr>
</div>

<div id="demographics">
<p>Please make your selections and press the calculate button</p>
<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</p>

</div>
<div id="rx"></div>

</body>

</html>
